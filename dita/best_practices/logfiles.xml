<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_crh_2fc_3r">
  <title>监控Greenplum数据库日志文件</title>
  <body>
    <p>了解系统日志文件的位置和内容并且定期监控它们而不是在问题发生时才监控。</p>
    <p>下面的表格展示了各种Greenplum数据库日志文件的位置。在文件路径中：</p><ul>
      <li><codeph>$GPADMIN_HOME</codeph> 是操作系统用户<codeph>gpadmin</codeph>的家目录
        路径。</li>
        <li><codeph>$MASTER_DATA_DIRECTORY</codeph>是Greenplum数据库master主机的数据目录。</li>
      <li><codeph>$GPDATA_DIR</codeph>是Greenplum数据库segment主机的数据目录。</li>
        <li><codeph><varname>host</varname></codeph>表示segment主机的主机名。</li>
        <li><codeph><varname>segprefix</varname></codeph>是segment前缀。</li>
        <li><codeph><varname>N</varname></codeph>是segment实例数量。</li>
      <li><codeph><varname>date</varname></codeph>是<codeph>YYYYMMDD</codeph>格式的日期。</li>
      </ul>
    <p> </p>
    <table id="table_mkp_cgc_3r">
      <tgroup cols="2">
        <colspec colnum="1" colname="col1"/>
        <colspec colnum="2" colname="col2"/>
        <thead>
          <row>
            <entry>路径</entry>
            <entry>描述</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>
              <codeph>$GPADMIN_HOME/gpAdminLogs/*</codeph>
            </entry>
            <entry>很多不同种类的日志文件，每台服务器都有的目录。<codeph>$GPADMIN_HOME</codeph>是<codeph>gpAdminLogs/</codeph>目录的
              默认存放位置。用户也可以在运行管理工具命令时指定一个另外的位置。</entry>
          </row>
          <row>
            <entry>
              <codeph>$GPADMIN_HOME/gpAdminLogs/gpinitsystem_<varname>date</varname>.log</codeph>
            </entry>
            <entry>系统初始化日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$GPADMIN_HOME/gpAdminLogs/gpstart_<varname>date</varname>.log</codeph>
            </entry>
            <entry>启动日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$GPADMIN_HOME/gpAdminLogs/gpstop_<varname>date</varname>.log</codeph>
            </entry>
            <entry>停止日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$GPADMIN_HOME/gpAdminLogs/gpsegstart.py_<varname>host</varname>:gpadmin_<varname>date</varname>.log</codeph>
            </entry>
            <entry>segment主机启动日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$GPADMIN_HOME/gpAdminLogs/gpsegstop.py_<varname>host</varname>:gpadmin_<varname>date</varname>.log</codeph>
            </entry>
            <entry>segment主机停止日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$MASTER_DATA_DIRECTORY/pg_log/startup.log</codeph>,
              <codeph>$GPDATA_DIR/<varname>segprefixN</varname>/pg_log/startup.log</codeph>
            </entry>
            <entry>segment实例启动日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$MASTER_DATA_DIRECTORY/gpperfmon/logs/gpmon.*.log</codeph>
            </entry>
            <entry>gpperfmon日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$MASTER_DATA_DIRECTORY/pg_log/*.csv</codeph>,
              <codeph>$GPDATA_DIR/<varname>segprefixN</varname>/pg_log/*.csv</codeph>
            </entry>
            <entry>master和segment数据库日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$GPDATA_DIR/mirror/<varname>segprefixN</varname>/pg_log/*.csv</codeph>
            </entry>
            <entry>镜像segment数据库日志</entry>
          </row>
          <row>
            <entry>
              <codeph>$GPDATA_DIR/primary/<varname>segprefixN</varname>/pg_log/*.csv</codeph>
            </entry>
            <entry>主segment数据库日志</entry>
          </row>
          <row>
            <entry>
              <codeph>/var/log/messages</codeph>
            </entry>
            <entry>Linux系统消息</entry>
          </row>
        </tbody>
      </tgroup>
    </table>
    <p>首先使用<codeph>gplogfilter -t</codeph>（<codeph>--trouble</codeph>）在master日志中搜索以
      <codeph>ERROR:</codeph>、<codeph>FATAL:</codeph>或者<codeph>PANIC:</codeph>开始的消息。
      以<codeph>WARNING</codeph>开始的消息也可能提供有用的信息。</p>
    <p>要在segment主机上搜索日志文件，可以用<codeph>gpssh</codeph>从master主机连接到segment主机使用
      Greenplum的<codeph>gplogfilter</codeph>工具。用户可以通过<codeph>statement_id</codeph>在
      segment日志中定位对应的日志项。</p>
    <p>Greenplum数据库可以基于文件大小或当前日志文件年龄配置数据库日志的循环复写周期。<codeph>log_rotation_size</codeph>
      配置参数设置单独一个日志文件的循环触发大小。当前日志文件大小大于等于该值时，该文件被关闭并新建另一个
      日志文件。<codeph>log_rotation_age</codeph>配置参数指定当前日志文件的循环触发年龄。当从该文件
      创建到目前的时间达到该设置时，创建一个新的日志文件。默认的<codeph>log_rotation_age</codeph>为1d（1天），
      当前日志文件写完后，会创建一个新的以天为单位的文件。</p>

  </body>
</topic>
